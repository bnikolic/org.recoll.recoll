id: org.recoll.recoll
runtime: org.kde.Platform
runtime-version: 5.15-24.08
sdk: org.kde.Sdk
base: io.qt.qtwebengine.BaseApp
base-version: 5.15-24.08
command: recoll
rename-desktop-file: recoll-searchgui.desktop
rename-icon: recoll

sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --env=ASPELL_CONF=dict-dir /app/share/dicts; local-data-dir /app/share/datadicts
  - --env=ANTIWORDHOME=/app/share/antiword
  - --env=JUPYTER_DATA_DIR=/app/share/jupyter

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin

cleanup:
  - '*.a'
  - '*.la'
  - /share/aclocal
  - /share/doc
  - /share/man
cleanup-commands:
  - /app/cleanup-BaseApp.sh

modules:
  - name: aspell-en
    buildsystem: simple
    build-commands:
      - ./configure
      - make
      - make dictdir=/app/share/dicts datadir=/app/share/datadicts install
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/aspell/dict/en/aspell6-en-2020.12.07-0.tar.bz2
        sha256: 4c8f734a28a088b88bb6481fcf972d0b2c3dc8da944f7673283ce487eac49fb3
        x-checker-data:
          type: anitya
          project-id: 7838
          url-template: https://ftp.gnu.org/gnu/aspell/dict/en/aspell6-en-$version.tar.bz2

  - name: antiword
    buildsystem: simple
    build-commands:
      - make
      - cp antiword /app/bin
      - cp -r Resources /app/share/antiword
    sources:
      - type: archive
        url: https://web.archive.org/web/20221117105329if_/http://www.winfield.demon.nl/linux/antiword-0.37.tar.gz
        sha256: 8e2c000fcbc6d641b0e6ff95e13c846da3ff31097801e86702124a206888f5ac

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app
      - ./b2 install
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://archives.boost.io/release/1.86.0/source/boost_1_86_0.tar.bz2
        sha256: 1bed88e40401b2cb7a1f76d4bab499e352fa4d0c5f31c0dbae64e24d34d7513b
        x-checker-data:
          type: anitya
          project-id: 6845
          url-template: https://archives.boost.io/release/$version/source/boost_$major_$minor_$patch.tar.bz2

  - name: poppler
    buildsystem: cmake-ninja
    cleanup:
      - /share
    config-opts:
      - -DENABLE_CPP=OFF
      - -DENABLE_GLIB=OFF
      - -DENABLE_QT5=OFF
      - -DENABLE_QT6=OFF
    sources:
      - type: archive
        url: https://poppler.freedesktop.org/poppler-24.11.0.tar.xz
        sha256: 7723d880565211740c13649d24a300257b86ddd7fa2d208187ff7e5cc8dfbd58
        x-checker-data:
          type: anitya
          project-id: 3686
          url-template: https://poppler.freedesktop.org/poppler-$version.tar.xz

  - name: unrtf
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/unrtf/unrtf-0.21.10.tar.gz
        sha256: b49f20211fa69fff97d42d6e782a62d7e2da670b064951f14bbff968c93734ae
        x-checker-data:
          type: anitya
          project-id: 5052
          url-template: https://ftp.gnu.org/gnu/unrtf/unrtf-$version.tar.gz

  - name: perl
    cleanup:
      - '*.h'
    sources:
      - type: archive
        url: https://www.cpan.org/src/5.0/perl-5.40.0.tar.gz
        sha256: c740348f357396327a9795d3e8323bafd0fe8a5c7835fc1cbaba0cc8dfe7161f
        x-checker-data:
          type: html
          url: https://www.perl.org/get.html
          pattern: (https://www.cpan.org/src/([\d\.]+)/perl-([\d\.]+).tar.gz)
      - type: script
        dest-filename: configure
        commands:
          - ./Configure -des -Dprefix=/app
    post-install:
      - find /app/lib/perl5 -type f -exec chmod u+w {} \;

  - name: exiftool
    buildsystem: simple
    build-commands:
      - perl Makefile.PL
      - make install
    sources:
      - type: archive
        url: https://exiftool.org/Image-ExifTool-13.03.tar.gz
        sha256: 0912e1315318889574f355e5832340632c556a14d30711e94d801085ad0a8e4f
        x-checker-data:
          type: anitya
          project-id: 6175
          url-template: https://exiftool.org/Image-ExifTool-$version.tar.gz

  - name: libzmq
    sources:
      - type: archive
        url: https://github.com/zeromq/libzmq/releases/download/v4.3.5/zeromq-4.3.5.tar.gz
        sha256: 6653ef5910f17954861fe72332e68b03ca6e4d9c7160eb3a8de5a5a913bfab43
        x-checker-data:
          type: anitya
          project-id: 16245
          url-template: https://github.com/zeromq/libzmq/releases/download/v$version/zeromq-$version.tar.gz

  - python3-jupyter.json

  - python3-lxml.json

  - name: xapian-core
    config-opts:
      - --disable-sse
      - --disable-backend-chert
      - --disable-backend-remote
      - --disable-documentation
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://oligarchy.co.uk/xapian/1.4.26/xapian-core-1.4.26.tar.xz
        sha256: 9e6a7903806966d16ce220b49377c9c8fad667c8f0ffcb23a3442946269363a7
        x-checker-data:
          type: anitya
          project-id: 15919
          url-template: https://oligarchy.co.uk/xapian/$version/xapian-core-$version.tar.xz

  - name: recoll
    buildsystem: meson
    build-options:
      env:
        QMAKEPATH: /app/lib
    config-opts:
      - -Dpython-chm=false
      - -Dwebengine=true
      - -Dsystemd=false
    sources:
      - type: archive
        url: https://recoll.org/recoll-1.40.4.tar.gz
        sha256: a48503c4b0040dc1a476340cb7a1afb34366c21ae665bdad3c9ef8958845c1fa
        x-checker-data:
          type: anitya
          project-id: 6256
          url-template: https://recoll.org/recoll-$version.tar.gz
